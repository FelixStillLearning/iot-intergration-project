services:
  # Service Utama: IoT Bridge (gRPC + WebSocket)
  iot-bridge:
    build: 
      context: .
      dockerfile: Dockerfile
    image: iot-bridge-app:v1.0
    container_name: iot_bridge_container
    ports:
      - "${GRPC_PORT}:${GRPC_PORT}"
      - "${WS_PORT}:${WS_PORT}"
    environment:
      - LOG_LEVEL=info
      - GRPC_PORT={GRPC_PORT}
    networks:
      - iot-internal-network
    restart: always

  # OpenDDS InfoRepo
  dds-repo:
    image: ubuntu:22.04
    container_name: dds_inforepo
    ports:
      - "${INFO_REPO_PORT}:${INFO_REPO_PORT}"
    command: ["/bin/bash", "-c", "echo 'Starting InfoRepo...' && sleep infinity"]
    networks:
      - iot-internal-network

networks:
  iot-internal-network:
    driver: bridge